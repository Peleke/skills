{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Decision Log Output",
  "description": "Structured output from the decision-log skill. Contains a scored, filtered, bias-checked decision record with pre-mortem analysis, kill criteria, and a next-step hint for persona-extract -- all grounded in signal scan data.",
  "type": "object",
  "required": [
    "decision_id",
    "date",
    "domain",
    "chosen_opportunity",
    "chosen_opportunity_data",
    "rationale",
    "constraints",
    "alternatives_rejected",
    "confidence",
    "revisit_by",
    "pre_mortem",
    "kill_criteria",
    "signal_scan_ref",
    "next_step",
    "next_step_input_hint"
  ],
  "properties": {
    "decision_id": {
      "type": "string",
      "pattern": "^decision-.+-\\d{4}-\\d{2}-\\d{2}$",
      "description": "Unique identifier for this decision, e.g. 'decision-devops-education-2026-02-08'"
    },
    "date": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601 date string"
    },
    "domain": {
      "type": "string",
      "description": "The domain this decision targets (e.g. 'DevOps education', 'cybersecurity careers')"
    },
    "decision_frame": {
      "type": "object",
      "required": ["question", "time_horizon", "success_metric", "constraints"],
      "properties": {
        "question": {
          "type": "string",
          "description": "One-sentence statement of what we are choosing"
        },
        "time_horizon": {
          "type": "string",
          "description": "When the bet resolves, e.g. '2 weeks', '1 month'"
        },
        "success_metric": {
          "type": "string",
          "description": "How we know it worked, e.g. 'first paying customer within 2 weeks'"
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Non-negotiable limits"
        }
      }
    },
    "chosen_opportunity": {
      "type": "string",
      "description": "Title of the selected opportunity from the signal scan"
    },
    "chosen_opportunity_data": {
      "type": "object",
      "required": ["title", "score", "scoring_breakdown", "thesis", "ship_candidates"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Opportunity title from the signal scan"
        },
        "score": {
          "type": "number",
          "minimum": 1,
          "maximum": 10,
          "description": "Original opportunity score from the signal scan"
        },
        "scoring_breakdown": {
          "type": "object",
          "required": [
            "pain_intensity",
            "spend_evidence",
            "edge_match",
            "time_to_ship",
            "competition_gap",
            "audience_fit"
          ],
          "properties": {
            "pain_intensity": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "description": "Original pain intensity score from scan"
            },
            "spend_evidence": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "description": "Original spend evidence score from scan"
            },
            "edge_match": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "description": "Original edge match score from scan"
            },
            "time_to_ship": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "description": "Original time to ship score from scan"
            },
            "competition_gap": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "description": "Original competition gap score from scan"
            },
            "audience_fit": {
              "type": "number",
              "minimum": 1,
              "maximum": 10,
              "description": "Original audience fit score from scan"
            }
          }
        },
        "thesis": {
          "type": "string",
          "description": "Why this opportunity exists -- the structural reason from the scan"
        },
        "ship_candidates": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["product", "format", "price_point", "ship_time", "distribution", "why_it_works"],
            "properties": {
              "product": {
                "type": "string",
                "description": "Product name and brief description"
              },
              "format": {
                "type": "string",
                "enum": ["PDF", "Notion template", "video", "video series", "course", "tool", "SaaS", "consultation", "community", "other"],
                "description": "Product format"
              },
              "price_point": {
                "type": "string",
                "description": "Recommended price grounded in SPEND data"
              },
              "ship_time": {
                "type": "string",
                "description": "Realistic time to ship"
              },
              "distribution": {
                "type": "string",
                "description": "Specific channel and strategy for reaching buyers"
              },
              "why_it_works": {
                "type": "string",
                "description": "Connects back to specific signals from the scan"
              }
            }
          }
        }
      }
    },
    "sdp_scoring": {
      "type": "object",
      "description": "Signal-to-Decision Pipeline re-scoring using SDP weights",
      "required": ["chosen", "alternatives"],
      "properties": {
        "chosen": {
          "$ref": "#/$defs/sdp_score_entry"
        },
        "alternatives": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/sdp_score_entry"
          },
          "description": "SDP scores for the top 2-3 alternatives, for comparison"
        }
      }
    },
    "strategic_filters": {
      "type": "object",
      "required": ["reversibility", "power_check"],
      "properties": {
        "reversibility": {
          "type": "object",
          "required": ["type", "reasoning"],
          "properties": {
            "type": {
              "type": "string",
              "enum": ["one-way-door", "two-way-door"],
              "description": "Bezos reversibility classification"
            },
            "reasoning": {
              "type": "string",
              "description": "Why this is reversible or irreversible"
            }
          }
        },
        "power_check": {
          "type": "object",
          "required": ["creates_power", "power_type", "reasoning"],
          "properties": {
            "creates_power": {
              "type": "boolean",
              "description": "Whether this opportunity creates or strengthens a competitive power"
            },
            "power_type": {
              "type": ["string", "null"],
              "enum": ["scale_economies", "network_economies", "counter_positioning", "switching_costs", "branding", "cornered_resource", "process_power", null],
              "description": "Which of Helmer's 7 Powers this creates, if any"
            },
            "reasoning": {
              "type": "string",
              "description": "Why this does or does not create a power"
            }
          }
        }
      }
    },
    "bias_check": {
      "type": "object",
      "required": ["result", "notes"],
      "properties": {
        "result": {
          "type": "string",
          "enum": ["pass", "flag"],
          "description": "Whether biases were detected (flag) or not (pass)"
        },
        "notes": {
          "type": "string",
          "description": "1-2 sentences on any concerns surfaced during the bias audit"
        },
        "checks": {
          "type": "object",
          "properties": {
            "confirmation_bias": {
              "type": "string",
              "description": "Assessment of confirmation bias risk"
            },
            "availability_bias": {
              "type": "string",
              "description": "Assessment of availability bias risk"
            },
            "anchoring": {
              "type": "string",
              "description": "Assessment of anchoring risk"
            },
            "excitement_bias": {
              "type": "string",
              "description": "Assessment of excitement bias risk"
            }
          }
        }
      }
    },
    "rationale": {
      "type": "string",
      "description": "2-3 sentences on WHY this opportunity won, referencing specific signal data (quotes, numbers, sources). 'It seemed best' is not a rationale."
    },
    "constraints": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Hard constraints provided by the operator, e.g. 'must ship in 1 day', 'PDF only'"
    },
    "alternatives_rejected": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["title", "reason", "score"],
        "properties": {
          "title": {
            "type": "string",
            "description": "Title of the rejected alternative"
          },
          "reason": {
            "type": "string",
            "description": "Specific reason for rejection -- must explain which dimensions dragged it down or why it lost despite scoring well"
          },
          "score": {
            "type": "number",
            "minimum": 12,
            "maximum": 60,
            "description": "SDP score of the rejected alternative"
          }
        }
      }
    },
    "confidence": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "description": "Confidence level in this decision, with justification in the rationale"
    },
    "confidence_justification": {
      "type": "string",
      "description": "Why the confidence level is what it is -- e.g. 'High: strong SPEND data with 10K+ students and 3 independent PAIN threads confirming the problem'"
    },
    "revisit_by": {
      "type": "string",
      "format": "date",
      "description": "ISO date when the operator will re-evaluate this decision"
    },
    "pre_mortem": {
      "type": "array",
      "minItems": 3,
      "items": {
        "type": "object",
        "required": ["category", "scenario"],
        "properties": {
          "category": {
            "type": "string",
            "enum": ["execution", "market_demand", "competition_timing"],
            "description": "Category of failure scenario"
          },
          "scenario": {
            "type": "string",
            "description": "Specific, plausible failure scenario -- not generic. Must describe what went wrong and why."
          }
        }
      },
      "description": "At least 3 failure scenarios: one execution, one market/demand, one competition/timing"
    },
    "kill_criteria": {
      "type": "array",
      "minItems": 2,
      "items": {
        "type": "object",
        "required": ["criterion", "phase", "measurable"],
        "properties": {
          "criterion": {
            "type": "string",
            "description": "The specific condition under which to abandon -- must be measurable and time-bounded"
          },
          "phase": {
            "type": "string",
            "enum": ["build", "market"],
            "description": "Whether this applies during build or after launch"
          },
          "measurable": {
            "type": "boolean",
            "description": "Confirmation that this criterion is objectively measurable"
          }
        }
      },
      "description": "Conditions under which to abandon -- defined before building to prevent sunk cost fallacy"
    },
    "signal_scan_ref": {
      "type": "string",
      "description": "Reference to the signal-scan output used as input (artifact slug, e.g. 'devops-education-2026-02-08')"
    },
    "next_step": {
      "type": "string",
      "const": "persona-extract",
      "description": "The next skill in the pipeline"
    },
    "next_step_input_hint": {
      "type": "object",
      "required": [
        "opportunity_title",
        "domain",
        "ship_candidates",
        "key_pain_signals",
        "key_spend_signals"
      ],
      "properties": {
        "opportunity_title": {
          "type": "string",
          "description": "Title of the chosen opportunity for persona-extract"
        },
        "domain": {
          "type": "string",
          "description": "Domain from the signal scan metadata"
        },
        "ship_candidates": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["product", "format", "price_point", "ship_time"],
            "properties": {
              "product": {
                "type": "string"
              },
              "format": {
                "type": "string"
              },
              "price_point": {
                "type": "string"
              },
              "ship_time": {
                "type": "string"
              }
            }
          },
          "description": "Ship candidates from the chosen opportunity to focus persona research"
        },
        "key_pain_signals": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["signal", "intensity", "source", "evidence"],
            "properties": {
              "signal": {
                "type": "string"
              },
              "intensity": {
                "type": "number"
              },
              "source": {
                "type": "string"
              },
              "evidence": {
                "type": "string"
              }
            }
          },
          "description": "Top 3-5 PAIN signals relevant to the chosen opportunity"
        },
        "key_spend_signals": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["signal", "price_range", "source", "platform"],
            "properties": {
              "signal": {
                "type": "string"
              },
              "price_range": {
                "type": "string"
              },
              "source": {
                "type": "string"
              },
              "platform": {
                "type": "string"
              }
            }
          },
          "description": "Top 3-5 SPEND signals relevant to the chosen opportunity"
        }
      }
    }
  },
  "$defs": {
    "sdp_score_entry": {
      "type": "object",
      "required": ["title", "sdp_score", "dimensions"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Opportunity title"
        },
        "sdp_score": {
          "type": "number",
          "minimum": 12,
          "maximum": 60,
          "description": "SDP weighted score: (pain*3) + (spend*3) + (edge*2) + (time*2) + (gap*1) + (audience*1)"
        },
        "dimensions": {
          "type": "object",
          "required": [
            "pain_intensity",
            "spend_evidence",
            "edge_match",
            "time_to_ship",
            "competition_gap",
            "audience_fit"
          ],
          "properties": {
            "pain_intensity": {
              "type": "object",
              "required": ["score", "justification"],
              "properties": {
                "score": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Pain intensity score (1-5)"
                },
                "justification": {
                  "type": "string",
                  "description": "One-sentence justification citing specific PAIN signals"
                }
              }
            },
            "spend_evidence": {
              "type": "object",
              "required": ["score", "justification"],
              "properties": {
                "score": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Spend evidence score (1-5)"
                },
                "justification": {
                  "type": "string",
                  "description": "One-sentence justification citing specific SPEND signals"
                }
              }
            },
            "edge_match": {
              "type": "object",
              "required": ["score", "justification"],
              "properties": {
                "score": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Edge match score (1-5)"
                },
                "justification": {
                  "type": "string",
                  "description": "One-sentence justification citing operator edge"
                }
              }
            },
            "time_to_ship": {
              "type": "object",
              "required": ["score", "justification"],
              "properties": {
                "score": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Time to ship score (1-5)"
                },
                "justification": {
                  "type": "string",
                  "description": "One-sentence justification citing ship candidates"
                }
              }
            },
            "competition_gap": {
              "type": "object",
              "required": ["score", "justification"],
              "properties": {
                "score": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Competition gap score (1-5)"
                },
                "justification": {
                  "type": "string",
                  "description": "One-sentence justification citing COMPETITIVE + SENTIMENT signals"
                }
              }
            },
            "audience_fit": {
              "type": "object",
              "required": ["score", "justification"],
              "properties": {
                "score": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Audience fit score (1-5)"
                },
                "justification": {
                  "type": "string",
                  "description": "One-sentence justification citing AUDIENCE signals"
                }
              }
            }
          }
        }
      }
    }
  }
}
